[globals]
; Глобальные переменные
TRUNK=trunk-provider              ; Имя trunk провайдера
INTERNAL_PREFIX=1                 ; Префикс для внутренних номеров
EXTERNAL_PREFIX=9                 ; Префикс для внешних вызовов

; ============================================
; КОНТЕКСТ ПО УМОЛЧАНИЮ
; ============================================
[default]
; Если вызов не попал ни в один контекст
exten => _X.,1,NoOp(Вызов в контекст по умолчанию: ${EXTEN})
 same => n,Playback(invalid)
 same => n,Hangup()

; ============================================
; ВНУТРЕННИЙ КОНТЕКСТ (для внутренних пользователей)
; ============================================
[internal]
; Разрешаем вызовы только между внутренними номерами
exten => _1XXX,1,NoOp(Внутренний вызов: ${CALLERID(num)} -> ${EXTEN})
 same => n,Dial(SIP/${EXTEN},30)
 same => n,Voicemail(${EXTEN},u)
 same => n,Hangup()

; Исходящие вызовы через внешний trunk (префикс 9)
exten => _9.,1,NoOp(Исходящий вызов: ${CALLERID(num)} -> ${EXTEN:1})
 same => n,Set(CALLERID(num)=${CALLERID(num)})
 same => n,Dial(SIP/${EXTEN:1}@${TRUNK},60)
 same => n,Hangup()

; Вызов на номер 1000 - эхо-тест
exten => 1000,1,NoOp(Эхо-тест)
 same => n,Answer()
 same => n,Wait(1)
 same => n,Playback(demo-thanks)
 same => n,Echo()
 same => n,Hangup()

; Вызов на номер 1001 - информация
exten => 1001,1,NoOp(Информация)
 same => n,Answer()
 same => n,Playback(hello-world)
 same => n,Hangup()

; ============================================
; КОНТЕКСТ ДЛЯ ВХОДЯЩИХ ВЫЗОВОВ С TRUNK
; ============================================
[from-trunk]
; Входящий вызов с внешнего trunk
exten => _X.,1,NoOp(Входящий вызов с trunk: ${EXTEN} от ${CALLERID(num)})
 same => n,Set(CALLERID(num)=${EXTEN})
 same => n,Dial(SIP/1001&SIP/1002&SIP/1003,30)
 same => n,Voicemail(1001,u)
 same => n,Hangup()

; Можно настроить маршрутизацию по DID (Direct Inward Dialing)
; Например, если провайдер передает номер в формате +7XXXXXXXXXX
; exten => _+7XXXXXXXXXX,1,NoOp(DID вызов: ${EXTEN})
;  same => n,Set(INTERNAL_NUM=${EXTEN:2})  ; Убираем +7
;  same => n,Dial(SIP/1${INTERNAL_NUM},30)
;  same => n,Hangup()

; ============================================
; КОНТЕКСТ ДЛЯ AGI СКРИПТОВ (интеграция с Node.js)
; ============================================
[agi-context]
; Пример вызова AGI скрипта
exten => _X.,1,NoOp(AGI вызов: ${EXTEN})
 same => n,Answer()
 same => n,AGI(agi://nodejs-server:3000/process-call)
 same => n,Hangup()

; ============================================
; КОНТЕКСТ ДЛЯ ЗАПИСИ РАЗГОВОРОВ
; ============================================
[record-context]
exten => _X.,1,NoOp(Запись разговора: ${EXTEN})
 same => n,Answer()
 same => n,MixMonitor(${EXTEN}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)}.wav)
 same => n,Dial(SIP/${EXTEN},30)
 same => n,Hangup()

; ============================================
; КОНТЕКСТ ДЛЯ ОЧЕРЕДИ (QUEUE)
; ============================================
[queue-context]
exten => 2000,1,NoOp(Очередь поддержки)
 same => n,Answer()
 same => n,Queue(support)
 same => n,Hangup()

; ============================================
; КОНТЕКСТ ДЛЯ КОНФЕРЕНЦИЙ
; ============================================
[conference-context]
exten => 3000,1,NoOp(Конференция)
 same => n,Answer()
 same => n,ConfBridge(3000)
 same => n,Hangup()

